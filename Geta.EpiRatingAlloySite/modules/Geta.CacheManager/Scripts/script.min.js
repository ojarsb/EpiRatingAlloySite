require(["dojo"],function(n){function i(){this.system={machineName:n.byId("cm-machine-name"),systemMemory:{element:n.query(".memory-usage-bar","cm-system-memory")[0],label:n.query(".memory-usage-text","cm-system-memory")[0],valueBar:n.query(".memory-usage-bar-inner","cm-system-memory")[0]},appPath:n.byId("cm-app-path"),appCacheCount:n.byId("cm-app-cache-count")},this.cache={selectAll:n.query("thead .select-all","tblCacheList")[0],cacheList:n.query("tbody","tblCacheList")[0],filterInput:n.byId("tblFilter")},this.pager={nextPageBtn:n.query(".next-page","cacheListPager")[0],prevPageBtn:n.query(".prev-page","cacheListPager")[0],firstPageBtn:n.query(".first-page","cacheListPager")[0],lastPageBtn:n.query(".last-page","cacheListPager")[0],pageNumber:n.query(".page-number","cacheListPager")[0],totalPages:n.query(".total-pages","cacheListPager")[0],pageSize:n.query(".page-size","cacheListPager")[0]},this.ajaxData={sortBy:"Size",ascending:!1,pageNumber:1,pageSize:10},this.init()}var t={element:n.byId("ajaxOverlay"),show:function(){n.style(this.element,"display","block"),n.fadeIn({node:this.element}).play()},hide:function(){n.fadeOut({node:this.element}).play(),n.style(this.element,"display","none")}};i.prototype={init:function(){var i=this,u,r,f;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=this.length>>>0,t=Number(arguments[1])||0;for(t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=i);t<i;t++)if(t in this&&this[t]===n)return t;return-1}),n.connect(n.byId("btnRefresh"),"onclick",function(){i.ajaxData.pageNumber=1,i.update()}),n.connect(n.byId("btnClearCache"),"onclick",function(){i.deleteAllCache()}),n.connect(i.cache.selectAll,"onclick",function(){for(var i=n.query('tbody input[type="checkbox"]',"tblCacheList"),t=0,r=i.length;t<r;t++)i[t].checked=this.checked}),n.connect(n.byId("btnDeleteSelected"),"onclick",function(){i.deleteSelectedCache()}),n.connect(i.cache.filterInput,"keypress",function(){clearTimeout(u),u=setTimeout(function(){i.filterTable(i.cache.filterInput.value)},300)}),r=n.query("thead .sortKey","tblCacheList"),r.connect("onclick",function(){var t=n.attr(this,"data-sortKey"),u;t&&t.length!=0&&(u=n.hasClass(this,"active"),u?n.hasClass(this,"asc")?n.removeClass(this,"asc"):n.addClass(this,"asc"):(n.forEach(r,function(t){n.removeClass(t,["active","asc"])}),n.addClass(this,"active")),i.ajaxData.sortBy=t,i.ajaxData.ascending=n.hasClass(this,"asc"),i.updateCacheList())}),f=n.query('input[type="button"]',"cacheListPager"),f.connect("onclick",function(t){n.stopEvent(t);var r=parseInt(i.pager.pageNumber.value,10),u=parseInt(i.pager.totalPages.innerHTML,10);if(n.hasClass(this,"prev-page")){if(parseInt(i.pager.pageNumber.value,10)<=1)return;i.ajaxData.pageNumber=r-1}else if(n.hasClass(this,"next-page")){if(i.ajaxData.pageNumber>=u)return;i.ajaxData.pageNumber=r+1}else n.hasClass(this,"first-page")?i.ajaxData.pageNumber=1:n.hasClass(this,"last-page")&&(i.ajaxData.pageNumber=u);i.updateCacheList()}),n.connect(i.pager.pageNumber,"keypress",function(t){if(t.keyCode==n.keys.ENTER){var r=parseInt(i.pager.pageNumber.value,10),u=parseInt(i.pager.totalPages.innerHTML,10);i.ajaxData.pageNumber=r<1?1:r>u?u:r,i.updateCacheList()}}),n.connect(i.pager.pageSize,"change",function(){i.ajaxData.pageSize=parseInt(i.pager.pageSize.value,10),i.ajaxData.pageNumber=1,i.updateCacheList()}),t.hide()},update:function(){this.updateSystemStats(),this.updateCacheList()},updateSystemStats:function(){var i=this;t.show(),n.xhrGet({url:"SystemStats/Get",handleAs:"json",load:function(t){if(t&&t.status){if(t.status=="success"){var r=t.data;i.system.machineName.innerHTML=r.MachineName,i.system.appPath.innerHTML=r.ApplicationPath,i.system.appCacheCount.innerHTML=r.AppCacheCount,i.system.systemMemory.label.innerHTML=r.SystemMemory.UsedFormatted+" of "+r.SystemMemory.TotalFormatted,n.style(i.system.systemMemory.valueBar,"width",r.SystemMemory.UsedPercentage+"%"),n.removeClass(i.system.systemMemory.element,["critical","warning"]),r.SystemMemory.UsedPercentage>90?n.addClass(i.system.systemMemory.element,"critical"):r.SystemMemory.UsedPercentage>75&&n.addClass(i.system.systemMemory.element,"warning")}}else i.errorHandler(!0,t)},error:function(n,t){i.errorHandler(!0,n,t)},handle:function(){t.hide()}})},updateCacheList:function(){var i=this;t.show(),i.cache.selectAll.checked=!1,n.xhrGet({url:"Cache/Get",handleAs:"json",content:i.ajaxData,load:function(n){var u,f,r,e,t;if(n&&n.status)if(n.status=="success"){for(u=n.data.CacheList,f="",r=0,e=u.length;r<e;r++)t=u[r],f+='<tr>                                    <td><input type="checkbox" value="'+t.Key+'"/><\/td>                                    <td>'+t.Key+"<\/td>                                    <td>"+t.Value+"<\/td>                                    <td>"+t.EntryType+"<\/td>                                    <td>"+t.SizeFormatted+"<\/td>                                    <td>"+t.CreatedFormatted+"<\/td>                                    <td>"+t.ExpiresFormatted+"<\/td>                                    <\/tr>";i.cache.cacheList.innerHTML=f,i.cache.filterInput.value="",i.updatePager(n.data.PageNumber,n.data.TotalPages)}else i.cache.cacheList.innerHTML='<tr><td colspan="7">Error<\/td><\/tr>';else i.errorHandler(!0,n)},error:function(n,t){i.errorHandler(!0,n,t)},handle:function(){t.hide()}})},updatePager:function(n,t){this.pager.pageNumber.value=n,this.pager.totalPages.innerHTML=t},filterTable:function(t){for(var u=n.query("tbody tr","tblCacheList"),r,e,i=0,f=u.length;i<f;i++)r=u[i],e=r.innerText||r.textContent,r.style.display=e.toLowerCase().indexOf(t)>-1||t.length==0?"":"none"},deleteAllCache:function(){var t=this;n.xhrGet({url:"Cache/Clear",handleAs:"json",load:function(n){n&&n.status?n.status=="success"&&(t.ajaxData.pageNumber=1,t.update()):t.errorHandler(!0,n)},error:function(n,i){t.errorHandler(!0,n,i)}})},deleteSelectedCache:function(){var t=this,u=n.query('tbody input[type="checkbox"]:checked',"tblCacheList"),i,r,f;if(u.length!=0){for(i=[],r=0,f=u.length;r<f;r++)i.push(u[r].value);i.length!=0&&n.xhrPost({url:"Cache/DeleteSelected",postData:n.toJson({list:i}),handleAs:"json",headers:{"Content-Type":"application/json"},load:function(n){n&&n.status?n.status=="success"&&(t.ajaxData.pageNumber=1,t.update()):t.errorHandler(!0,n)},error:function(n,i){t.errorHandler(!0,n,i)}})}},errorHandler:function(n){alert("An error has occurred. If this problem persists, please contact your system administrator."),n&&location.reload(!0)}},n.ready(function(){return new i})});
//@ sourceMappingURL=script.min.js.map